---
import { getCollection } from "astro:content";
const assets = await getCollection("assets");
---

<div class="gallery">
    {assets && assets.length ? (
        assets.map(asset => (
            <img src={asset.data.secure_url} alt={asset.data.public_id} loading="lazy" />
        ))
    ) : (
        <p class="empty">No hay cartas para mostrar.</p>
    )}
    
</div>

<style>
    :global(.gallery) {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 16px;
        width: 100%;
        padding: 20px;
    }

    :global(.gallery img), :global(.gallery-img) {
        width: 100%;
        height: auto;
        object-fit: cover;
        border-radius: 8px;
        transition: transform 0.3s ease; 
    }

    :global(.gallery img:hover), :global(.gallery-img:hover) {
        transform: scale(1.05); 
    }

</style>

<script type="module">
    if (typeof window !== 'undefined') {
        const gallery = document.querySelector('.gallery');
        const empty = document.querySelector('.empty');
        window.addEventListener('asset:added', (ev) => {
            const res = ev.detail;
            const src = res.secure_url || res.url || '';
            const img = document.createElement('img');
            img.src = src;
            img.alt = res.public_id || 'Carta';
            img.loading = 'lazy';
            img.classList.add('gallery-img');
            img.style.width = '100%';
            img.style.height = 'auto';
            img.style.objectFit = 'cover';
            img.style.borderRadius = '8px';
            if (gallery) gallery.prepend(img);
            if (empty) empty.remove();
        });
    }
</script>
