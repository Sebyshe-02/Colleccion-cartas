<div id="container-upload">
    <form id="uploadForm" enctype="multipart/form-data">
        <input id="file" type="file" name="file" accept="image/*" required/>
        <label for="file">Elegir archivo</label>
        <button id="submit-btn" type="submit">Subir carta</button>
    </form>
    <div id="upload-status" aria-live="polite"></div>
</div>


<style>
    #container-upload {
        margin-bottom: 1rem;
    }

    input[type="file"] {
        margin-right: 0.5rem;
        
    }

    /* Estilo para el botón interno del input file (navegadores modernos) */
    input[type="file"]::file-selector-button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 6px 12px;
        margin-right: 0.5rem;
        border-radius: 4px;
        cursor: pointer;
    }

    /* WebKit prefijo para compatibilidad con navegadores basados en WebKit */
    input[type="file"]::-webkit-file-upload-button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 6px 12px;
        margin-right: 0.5rem;
        border-radius: 4px;
        cursor: pointer;
    }

    button{
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
    }

    button:hover {
        background-color: #45a049;
    }
</style>

<script type="module">
    const form = document.getElementById('uploadForm');
    const input = document.getElementById('file');
    const status = document.getElementById('upload-status');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        if (!input.files || input.files.length === 0) return;
        const file = input.files[0];
        const fd = new FormData();
        fd.append('file', file);
        status.textContent = 'Subiendo...';
        try {
            const res = await fetch('/api/upload', { method: 'POST', body: fd });
            if (!res.ok) {
                const text = await res.text();
                status.textContent = 'Error al subir';
                console.error('Upload failed', text);
                return;
            }
            const asset = await res.json();
            // Notificar a la galería para que muestre la imagen en tiempo real
            window.dispatchEvent(new CustomEvent('asset:added', { detail: asset }));
            status.textContent = 'Subida correcta';
            input.value = '';
        } catch (err) {
            console.error(err);
            status.textContent = 'Error en la subida';
        }
    });
</script>
